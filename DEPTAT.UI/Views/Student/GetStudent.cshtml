@{
	var programmeList = ViewBag.ProgrammeList as List<ProgrammeResponse>;
}

@model DEPTAT.Application.Responses.StudentResponse

<div class="container-fluid">
	<div class="block-header">
		<h2>Student</h2>
	</div>

	<!-- Horizontal Layout -->
	<div class="row clearfix">
		<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
			<div class="card">
				<div class="header">
					<h2>
						UPDATE STUDENT
					</h2>
					<ul class="header-dropdown m-r--5">
						<li class="dropdown">
							<a href="javascript:void(0);" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
								<i class="material-icons">more_vert</i>
							</a>
							<ul class="dropdown-menu pull-right">
								<li><a asp-controller="Student" asp-action="Register">Add Student</a></li>
								<li><a asp-controller="Student" asp-action="Detailed">View Student</a></li>
							</ul>
						</li>
					</ul>
				</div>
				<div class="body">
					<form class="form-horizontal" id="registerForm" method="post" enctype="multipart/form-data">
						<div class="row clearfix">
							<div class="col-md-6 col-sm-6">
							</div>
							<div class="col-md-6 col-sm-6"></div>
						</div>
						<div class="row clearfix">
							<div class="col-lg-2 col-md-2 col-sm-4 col-xs-4 form-control-label">
								<label for="imageUrl">Select Image</label>
							</div>
							<div class="col-lg-4 col-md-5 col-sm-4 col-xs-4">
								<div id="img-preview"></div>
								<label class="file-input-button" style="margin-top: 10px;">
									<input type="file" accept="image/*" id="imageUrl" name="imageUrl">
									<span>Image</span>
								</label>
							</div>

						</div>
						<div class="row clearfix">
							<div class="col-lg-2 col-md-2 col-sm-4 col-xs-5 form-control-label">
								<label for="indexNumber">Index Number</label>
							</div>
							<div class="col-lg-10 col-md-10 col-sm-8 col-xs-7">
								
								<div class="form-group">
									<div class="form-line">
										<input type="text" id="indexNumber" name="StudentNumber" class="form-control" placeholder="Enter your Index Number"  readonly="readonly">
									</div>
								</div>
							</div>
						</div>
						<div class="row clearfix">
							<div class="col-lg-2 col-md-2 col-sm-4 col-xs-5 form-control-label">
								<label for="firstName">First Name</label>
							</div>
							<div class="col-lg-10 col-md-10 col-sm-8 col-xs-7">
								<div class="form-group">
									<div class="form-line">
										<input type="text" id="firstName" name="FirstName" class="form-control" placeholder="Enter your First Name">
									</div>
								</div>
							</div>
						</div>


						<div class="row clearfix">
							<div class="col-lg-2 col-md-2 col-sm-4 col-xs-5 form-control-label">
								<label for="email_address_2">Other Name</label>
							</div>
							<div class="col-lg-10 col-md-10 col-sm-8 col-xs-7">
								<div class="form-group">
									<div class="form-line">
										<input type="text" id="otherName" name="OtherName" class="form-control" placeholder="Enter your Other Name" >
									</div>
								</div>
							</div>
						</div>
						<div class="row clearfix">
							<div class="col-lg-2 col-md-2 col-sm-4 col-xs-5 form-control-label">
								<label for="password_2">Last Name</label>
							</div>
							<div class="col-lg-10 col-md-10 col-sm-8 col-xs-7">
								<div class="form-group">
									<div class="form-line">
										<input type="text" id="lastName" name="LastName" class="form-control" placeholder="Enter your Last Name" >
									</div>
								</div>
							</div>
						</div>


						@*<div class="row clearfix">
						<div class="col-lg-2 col-md-2 col-sm-4 col-xs-5 form-control-label">
						<label for="status">Status</label>
						</div>
						<div class="col-lg-10 col-md-10 col-sm-8 col-xs-7">
						<div class="form-group">
						<div class="form-line">
						<input type="text" id="status" name="Status" class="form-control" placeholder="Enter your email address">
						</div>
						</div>
						</div>
						</div>*@
						<div class="row clearfix">
							<div class="col-lg-2 col-md-2 col-sm-4 col-xs-5 form-control-label">
								<label for="status">Status</label>
							</div>
							<div class="col-lg-10 col-md-10 col-sm-8 col-xs-7">
								<div class="form-group">
									<div class="form-line">
										<select class="form-control show-tick" id="status" name="Status" >
											<option value="0">-- Please select --</option>
											<option value="1">In School</option>
											<option value="2">Rusticated</option>
											<option value="3">Withdrawn</option>
											<option value="4">Dismissed</option>
											<option value="5">Complete</option>

										</select>
									</div>
								</div>
							</div>
						</div>

						@*<div class="row clearfix">
							<div class="col-lg-2 col-md-2 col-sm-4 col-xs-5 form-control-label">
								<label for="status">Level</label>
							</div>
							<div class="col-lg-10 col-md-10 col-sm-8 col-xs-7">
								<div class="form-group">
									<div class="form-line">
										<select class="form-control show-tick" id="level" name="Level" >
											<option value="0">-- Please select --</option>
											<option value="100">100</option>
											<option value="200">200</option>
											<option value="300">300</option>
											<option value="400">400</option>
										</select>
									</div>
								</div>
							</div>
						</div>
*@

						<div class="row clearfix">
							<div class="col-lg-2 col-md-2 col-sm-4 col-xs-5 form-control-label">
								<label for="academicYear">Year Group</label>
							</div>
							<div class="col-lg-10 col-md-10 col-sm-8 col-xs-7">
								<div class="form-group">
									<div class="form-line">
										<input type="text" id="yearGroup" name="YearGroup" class="form-control" placeholder="Enter your Year Group" readonly="readonly">
									</div>
								</div>
							</div>
						</div>


						<div class="row clearfix">
							<div class="col-lg-2 col-md-2 col-sm-4 col-xs-5 form-control-label">
								<label for="academicYear">Academic Year</label>
							</div>
							<div class="col-lg-10 col-md-10 col-sm-8 col-xs-7">
								<div class="form-group">
									<div class="form-line">
										<input type="text" id="academicYear" name="AcademicYear" class="form-control" placeholder="Enter your Academic Year" readonly="readonly">
									</div>
								</div>
							</div>
						</div>


						<div class="row clearfix">
							<div class="col-lg-2 col-md-2 col-sm-4 col-xs-5 form-control-label">
								<label for="email_address_2">Class Year</label>
							</div>
							<div class="col-lg-10 col-md-10 col-sm-8 col-xs-7">
								<div class="form-group">
									<div class="form-line">
										<input type="text" id="classYear" name="ClassYear" class="form-control" placeholder="Enter your Class Year">
									</div>
								</div>
							</div>
						</div>
						<div class="row clearfix">
							<div class="col-lg-2 col-md-2 col-sm-4 col-xs-5 form-control-label">
								<label for="admittedYear">Admitted Year</label>
							</div>
							<div class="col-lg-10 col-md-10 col-sm-8 col-xs-7">
								<div class="form-group">
									<div class="form-line">
										<input type="text" id="admittedYear" name="AdmittedYear" class="form-control" placeholder="Enter your Admitted Year" readonly="readonly">
									</div>
								</div>
							</div>
						</div>


						<div class="row clearfix">
							<div class="col-lg-2 col-md-2 col-sm-4 col-xs-5 form-control-label">
								<label for="phoneNumber">PhoneNumber</label>
							</div>
							<div class="col-lg-10 col-md-10 col-sm-8 col-xs-7">
								<div class="form-group">
									<div class="form-line">
										<input type="text" id="phoneNumber" name="PhoneNumber" class="form-control"  placeholder="Enter your Phone Number">
									</div>
								</div>
							</div>
						</div>

						<div class="row clearfix">
							<div class="col-lg-2 col-md-2 col-sm-4 col-xs-5 form-control-label">
								<label for="email">Email Address</label>
							</div>
							<div class="col-lg-10 col-md-10 col-sm-8 col-xs-7">
								<div class="form-group">
									<div class="form-line">
										<input type="text" id="email" name="Email" class="form-control" placeholder="Enter your email address">

									</div>
								</div>
							</div>
						</div>

						<div class="row clearfix">
							<div class="col-lg-2 col-md-2 col-sm-4 col-xs-5 form-control-label">
								<label for="email">Programme</label>
							</div>
							<div class="col-lg-10 col-md-10 col-sm-8 col-xs-7">
								<div class="form-group">
									<div class="form-line">
										<select class="form-control show-tick" id="programmeId" name="ProgrammeId">
											<option value="0">-- Please select --</option>
											@foreach (var programme in programmeList)
											{
												<option value="@programme.Id">@programme.Name</option>
											}
										</select>
									</div>
								</div>
							</div>
						</div>



						<div class="row clearfix">
							<div align="right">
								
								<button type="submit" id="updateCourse" class="btn btn-primary m-t-15 waves-effect">
									UPDATE
								</button>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
	<!-- #END# Horizontal Layout -->

</div>

<script type="text/ecmascript">
	const chooseFile = document.getElementById("imageUrl");
	const imgPreview = document.getElementById("img-preview");


		chooseFile.addEventListener("change", function () {
	  getImgData();
	});

		function getImgData() {
	  const files = chooseFile.files[0];
	  if (files) {
		const fileReader = new FileReader();
		fileReader.readAsDataURL(files);
		fileReader.addEventListener("load", function () {
		  imgPreview.style.display = "block";
		  imgPreview.innerHTML = '<img src="' + this.result + '" width="50%"/>';
		});
	  }
	}
</script>

<script>

	$(document).ready(function () {
		$("#studendId").hide();
		setData();
		function setData() {
			// Get the current URL with the query string
			var url = window.location.href;
			var baseurl = $('#base_url').text();

			// Use a regular expression to extract the value of the "Id" parameter
			var regex = /\/\d+$/;
			var match = regex.exec(url);
			var StudentNumber = match && match[0].substring(1);
			// Display the value in the console or use it as needed
			$.ajax({
			    url: $('#base_url').text() + '/Student/FetchStudent',
			    type: 'GET',
				data: { StudentNumber: StudentNumber },

			    success: function(response) {
			        if (response.isSuccess) {
				        if (response.isSuccess) {
							$("#img-preview").html(`<img src="${baseurl}/uploads/${response.result.imageUrl}" width="50%" />`);
							//$("#studendId").val(response.result.id);
					        $("#indexNumber").val(response.result.studentNumber);
					        $("#firstName").val(response.result.firstName);
					        $("#otherName").val(response.result.otherName);
					        $("#lastName").val(response.result.lastName);
					        $("#status").val(response.result.status);
					        $("#level").val(response.result.level);
					        $("#yearGroup").val(response.result.yearGroup);
					        $("#academicYear").val(response.result.academicYear);
					        $("#classYear").val(response.result.classYear);
					       $("#admittedYear").val(response.result.admittedYear);
					        $("#phoneNumber").val(response.result.phoneNumber);
					        $("#email").val(response.result.email);
					        $("#programmeId").val(response.result.programmeId);
							
				        }
			        }
			       // window.location.href = response.redirectToUrl;

			    }
			});
		}




		$('#registerForm').submit(function (event) {
			event.preventDefault(); // Prevent the form from submitting normally

			// Create a new FormData object to store the form data
			var formData = new FormData(this);

			$.ajax({
				url: $('#base_url').text() + '/Student/Update',
				type: 'POST',
				data: formData,
				processData: false,
				contentType: false,
				success: function (response) {
					// Handle the success response here
					if (response.isSuccess) {
						showNotificationSuccessMessage(response.message, "Success");

					} else {
						showNotificationErrorMessage("Failed", response.message, "error");
					}
					//$('#registerForm')[0].reset();
					//imgPreview.innerHTML = "";
					window.location.href = $('#base_url').text() + "/Student/Detailed";
				},
				error: function (xhr, status, error) {
					// Handle the error response here
					showNotificationErrorMessage("Failed", error, "error");
					console.error(error);
				}
			});
		});
	});
</script>